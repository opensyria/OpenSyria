# OpenSY AssumeUTXO Manager

Tools for managing AssumeUTXO snapshots to enable fast node synchronization.

## Overview

AssumeUTXO allows new nodes to sync in **minutes instead of hours** by loading a pre-verified UTXO set snapshot. This is especially important for:
- Mobile/embedded devices with limited resources
- Quick disaster recovery
- Development and testing environments

## Quick Start

### Generate a New Snapshot

```bash
# Generate snapshot at safe height (current - 100 blocks)
python3 assumeutxo_manager.py generate \
    --rpc-user YOUR_USER \
    --rpc-password YOUR_PASSWORD

# Generate at specific height (must be multiple of 10000 for mainnet)
python3 assumeutxo_manager.py generate \
    --height 50000 \
    --rpc-user YOUR_USER \
    --rpc-password YOUR_PASSWORD
```

### Verify an Existing Snapshot

```bash
python3 assumeutxo_manager.py verify \
    --snapshot utxo-50000-20251221.dat
```

### Update chainparams.cpp

```bash
# Full workflow: generate + show update instructions
python3 assumeutxo_manager.py update \
    --rpc-user YOUR_USER \
    --rpc-password YOUR_PASSWORD
```

## Output Files

The generator creates three files:

| File | Description |
|------|-------------|
| `utxo-HEIGHT-DATE.dat` | The UTXO snapshot (binary) |
| `utxo-HEIGHT-DATE.json` | Metadata (height, hashes, sizes) |
| `utxo-HEIGHT-DATE.cpp.txt` | C++ code for chainparams.cpp |

## Using Snapshots

### For Node Operators

To sync a new node using AssumeUTXO:

```bash
# Download official snapshot
wget https://github.com/OpenSyria/OpenSyria/releases/download/v1.0/utxo-50000.dat

# Verify SHA256 (check release notes for hash)
sha256sum utxo-50000.dat

# Start node with snapshot
./opensyd -loadtxoutset=/path/to/utxo-50000.dat
```

The node will:
1. Load the snapshot immediately (seconds)
2. Start syncing from snapshot height
3. Validate the snapshot in the background

### For Developers

To add a new snapshot height to the code:

1. Generate snapshot on a trusted, fully-synced node
2. Copy the C++ code from `.cpp.txt` file
3. Update `src/kernel/chainparams.cpp` in the appropriate network section
4. Rebuild and test

## Recommended Update Schedule

| Chain Height | Action |
|--------------|--------|
| 50,000 | Add first snapshot after initial growth |
| 100,000 | Update snapshot |
| Every 50,000 | Periodic updates |

## Security Considerations

⚠️ **IMPORTANT**: AssumeUTXO snapshots are security-critical!

- Only use snapshots from official releases
- Always verify SHA256 hashes
- The `hash_serialized` in chainparams.cpp is the cryptographic commitment
- Background validation catches any tampering

### Snapshot Trust Model

```
┌─────────────────────────────────────────────────────────────┐
│  Official Snapshot                                           │
│  • Generated by trusted core developers                      │
│  • Hash committed in chainparams.cpp                        │
│  • Signed release with GPG keys                             │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  Node Loading Snapshot                                       │
│  1. Verify snapshot hash matches chainparams                 │
│  2. Load UTXO set (instant sync)                            │
│  3. Continue syncing from snapshot height                    │
│  4. Background thread validates entire chain                 │
│  5. If validation fails → snapshot rejected                  │
└─────────────────────────────────────────────────────────────┘
```

## Troubleshooting

### "Invalid snapshot magic"
The file is not a valid UTXO snapshot. Ensure you downloaded the correct file.

### "Network mismatch"
The snapshot was generated for a different network (mainnet vs testnet).

### "Height not in assumeutxo data"
The snapshot height doesn't match any entry in chainparams.cpp. Either use an official height or add the new height to the code.

## Requirements

- Python 3.8+
- requests library: `pip3 install requests`
- Running opensyd with RPC enabled

## Files

```
contrib/assumeutxo/
├── assumeutxo_manager.py    # Main management script
└── README.md                 # This file
```
